<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8"/>
    <title>流域可持续发展决策支持系统</title>
    <meta name="description" content="overview & stats"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <link rel="stylesheet" href="static/css/bootstrap.min.css"/>
    <link rel="stylesheet" href="static/css/bootstrap-responsive.min.css"/>
    <link rel="stylesheet" href="static/css/font-awesome.min.css"/>
    <link rel="stylesheet" href="static/css/jquery-ui-1.10.2.custom.min.css"/>
    <link rel="stylesheet" href="static/css/ace.min.css"/>
    <script type="text/javascript" src="static/1.9.1/jquery.min.js"></script>
    <script type="text/javascript" src="static/js/jquery-ui-1.10.2.custom.min.js"></script>
    <script type="text/javascript" src="js/echarts-all.js"></script>
    <style>
        body{overflow: hidden; position: relative; width: 100%;}
        #mapframe{width:100%;border: 0;}
        #right_flash,#right_flash2{width: 433px; height: auto; position: absolute; right: -400px; top: 10%; margin-top: 0;}
        .situation-toggle{font-size: 14px; text-align:left;width:20px; position: absolute; left: 0px;top: 40px;z-index: 110;}
        .situation{width:400px; position: relative; right:-33px; top:0px; z-index:10;}
        #right_flash2{right: -400px; margin-top: 125px; height: 300px; z-index: 20;}
        #right_flash2.down{margin-top: 278px;}
        .widget-body{border-top: 1px solid #CCCCCC;}
    </style>
</head>

<body>
<iframe id="mapframe" src="http://210.77.67.251:19001/map/index.jsp"
        scrolling="no"></iframe>
<div id="right_flash">
    <div class="widget-header situation-toggle" id="situation-toggle1" style="cursor: pointer;">
        	情景控制
    </div>
    <div id="situation1" class="widget-box situation">
        <div class="widget-body">
            <div class="widget-main">
                <div class="row-fluid">
                    	上游耕地面积：
                    <input type="text" id="situation-1" value="10" style="width:30px;height:10px">万亩
                    <div id="slider-1" style="float:right;display:inline;"></div>
                    <hr style="margin:0px;height:4px">
                </div>
                <div class="row-fluid">
                    <span style="visibility:hidden">中下游分水：</span> 中游&nbsp;下游
                </div>
                <div class="row-fluid">
                    	中下游分水：
                    <input type="text" id="situation-2-1" value="9" style="width:25px;height:10px">
                    <input type="text" id="situation-2-2" value="7" style="width:25px;height:10px">亿m^3
                    <div id="slider-2" style="float:right;display:inline;"></div>
                </div>
                <div class="row-fluid">
                    	中游耕地面积：
                    <input type="text" id="situation-3" value="568" style="width:30px;height:10px">万亩
                    <div id="slider-3" style="float:right;display:inline;"></div>
                </div>
                <div class="row-fluid">
                    	中游湿地面积：
                    <input type="text" id="situation-4" value="24.4" style="width:30px;height:10px">万亩
                    <div id="slider-4" style="float:right;display:inline;"></div>
                </div>
                <div class="row-fluid">
                    	中游滴灌面积：
                    <input type="text" id="situation-5" value="10" style="width:30px;height:10px">万亩
                    <div id="slider-5" style="float:right;display:inline;"></div>
                    <hr style="margin:0px;height:4px">
                </div>
                <div class="row-fluid">
                    	下游耕地面积：
                    <input type="text" id="situation-6" value="10" style="width:30px;height:10px">万亩
                    <div id="slider-6" style="float:right;display:inline;"></div>
                    <hr style="margin:0px;height:4px">
                </div>
                <div class="row-fluid" style="text-align:center;">
                    <button class="btn btn-mini btn-success" type="button" id="btn_eval">评价分析</button>
                </div>

            </div>
        </div>
    </div>
</div>

<div id="right_flash2">
    <div class="widget-header situation-toggle" id="situation-toggle2" style="cursor: pointer;">
        	评价结果
    </div>
    <div id="situation2" class="widget-box situation">
        <div class="widget-body">
            <div class="widget-main">
            	<div id="gis-chart-1" style="width:100%; height: 300px;"></div>
            </div>
        </div>
    </div>
</div>
<!-- 情景控制slider模块显示及控制 -->
<script type="text/javascript">
    $(function () {
    	drawchart();
    	
        $("#mapframe").attr("height", $(window).height());
        $("#slider-1").css({
            width: '42%',
            margin: '5px 5px 15px 5px'
        }).slider({
            value: 10,
            range: "min",
            min: 0,
            max: 50,
            step: 1,
            slide: function (event, ui) {
                var val = parseInt(ui.value);
                $("#situation-1").val(val);
            }
        });

        $("#slider-2").css({
            width: '42%',
            margin: '5px 5px 15px 5px'
        }).slider({
            value: 9,
            range: "min",
            min: 0,
            max: 16,
            step: 1,
            slide: function (event, ui) {
                var val = parseInt(ui.value);
                $("#situation-2-1").val(val);
                $("#situation-2-2").val(16 - val);
            }
        });

        $("#slider-3").css({
            width: '42%',
            margin: '5px 5px 15px 5px'
        }).slider({
            value: 568,
            range: "min",
            min: 0,
            max: 700,
            step: 10,
            slide: function (event, ui) {
                var val = parseInt(ui.value);
                $("#situation-3").val(val);
            }
        });

        $("#slider-4").css({
            width: '42%',
            margin: '5px 5px 15px 5px'
        }).slider({
            value: 24.4,
            range: "min",
            min: 0,
            max: 60,
            step: 1,
            slide: function (event, ui) {
                var val = parseInt(ui.value);
                $("#situation-4").val(val);
            }
        });

        $("#slider-5").css({
            width: '42%',
            margin: '5px 5px 15px 5px'
        }).slider({
            value: 10,
            range: "min",
            min: 0,
            max: 100,
            step: 5,
            slide: function (event, ui) {
                var val = parseInt(ui.value);
                $("#situation-5").val(val);
            }
        });

        $("#slider-6").css({
            width: '42%',
            margin: '5px 5px 15px 5px'
        }).slider({
            value: 10,
            range: "min",
            min: 0,
            max: 100,
            step: 5,
            slide: function (event, ui) {
                var val = parseInt(ui.value);
                $("#situation-6").val(val);
            }
        });

    });
    //绑定btn_eval按钮的点击事件
    $("#btn_eval").bind("click", function () {

        var json = {};
        json["#situation-1"] = $("#situation-1").val();
        json["#situation-2-1"] = $("#situation-2-1").val();
        json["#situation-2-1"] = $("#situation-2-1").val();
        json["#situation-3"] = $("#situation-3").val();
        json["#situation-4"] = $("#situation-4").val();
        json["#situation-5"] = $("#situation-5").val();
        json["#situation-6"] = $("#situation-6").val();
        //使用ajax将数据发送到服务端
        $.ajax({
            url: '<%=basePath%>admin/indexcompute.do',
            type: "POST",
            dataType: "json",
            data: json,
            /*error:function(){
             alert("保存指标失败，请重试！");
             },
             success:function(){
             alert("保存成功！");
             //将显示目标体系的show按钮设置为可用状态
             //$("#show").attr("disable",false);

             }	*/
        });

    });

    /*最右测滑入滑出*/
    var clicknum1 = false,
        clicknum2 = false;
    $("#situation-toggle1").click(function () {
        if(!clicknum2){
            if(!clicknum1){
                $("#right_flash").animate({right: "0"});
                $("#right_flash2").addClass("down");
            }else {
                $("#right_flash").animate({right: "-400px"});
                $("#right_flash2").removeClass("down");
            }
        }else{
            $("#right_flash2").animate({right: "-400px"}).addClass("down");
            $("#right_flash").animate({right: "0"});
            clicknum2 = !clicknum2;
        }
        clicknum1 = !clicknum1;
        console.log(clicknum1+"///"+clicknum2);
    });
    $("#situation-toggle2").click(function () {
        if(!clicknum1){
            if(!clicknum2){
                $("#right_flash2").animate({right: "0px"});
            }else {
                $("#right_flash2").animate({right: "-400px"});
            }
        }else{
            $("#right_flash").animate({right: "-400px"});
            $("#right_flash2").animate({right: "0px"}).removeClass("down");
            clicknum1 = !clicknum1;
        }
        clicknum2 = !clicknum2;
        console.log(clicknum1+"///"+clicknum2);
    });

	function drawchart(){
		var myChart = echarts.init(document.getElementById('gis-chart-1'));
		$.get("getGisEcharts.do",
				[],function(data){
				var xdata=[], Overall=[],P1=[],P2=[],P3=[];
				for(var i=0;i<data.length;i++){
					xdata[i]=data[i].year,
					Overall[i]=data[i].resultOverall,
					P1[i]=data[i].resultP1,
					P2[i]=data[i].resultP2,
					P3[i]=data[i].resultP3;
				}
		
				var option = {
				    tooltip : {
				        trigger: 'axis'
				    },
				    legend: {
				        data:['resultOverall','resultP1','resultP2','resultP3',]
				    },
				    toolbox: {
				        show : true,
				        feature : {
				            restore : {show: true},
				            saveAsImage : {show: true}
				        }
				    },
				    calculable : true,
				    xAxis : [
				        {
				            type : 'category',
				            boundaryGap : false,
				            data : xdata
				        }
				    ],
				    yAxis : [
				        {
				            type : 'value'
				        }
				    ],
				    series : [
				        {
				            name:'resultOverall',
				            type:'line',
				            stack: '总量',
				            data: Overall
				        },
				        {
				            name:'resultP1',
				            type:'line',
				            stack: '总量',
				            data: P1
				        },
				        {
				            name:'resultP2',
				            type:'line',
				            stack: '总量',
				            data:P2
				        },
				        {
				            name:'resultP3',
				            type:'line',
				            stack: '总量',
				            data:P3
				        }
				        
				    ]
				};
				myChart.setOption(option); 
		});
                   
	};
</script>
</body>

</html>